<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>ChatOnline</title>
	</head>
	<script src="https://ajax.aspnetcdn.com/ajax/jquery/jquery-1.6.4.min.js"></script>
	<body style="background-color: cornflowerblue;">
		<div style="background-color: aquamarine; width: 100%;text-align: center;font-family: tahoma;font-size: larger;z-index: 9;top: 0px;left: 0px;position: fixed;">
			<div style="padding: 10px;">
				ChatOnline
			</div>
			<label id="st" name="st" style="background-color: red;">未连接到服务器</label>
			<div>
				<table style="margin: auto;">
					<tr>
						<td>
							服务器地址:
						</td>
						<td>
							<input id="addr" name="addr" type="text" />
						</td>
						<td>
							<button id="conn" name="conn">连接</button>
						</td>
					</tr>
					<tr>
						<td>
							端口号:
						</td>
						<td>
							<input id="port" name="port" type="text" />
						</td>
						<td>
							<button id="disc" name="disc">断开</button>
						</td>
					</tr>
				</table>
			</div>
		</div>
		<div name="msg" id="msg" style="overflow: auto; position: absolute;top: 140px;left: 5px;right: 5px;bottom: 30%;background-color: azure;"></div>
		<div style="position: absolute;top: 70%;left: 0px;right: 0px;bottom: 0px;background-color: azure;">
			<table style="height: 100%;width: 100%;" cellpadding="0px" cellspacing="0px">
				<tr>
					<td rowspan="2" style="width: 70%;padding: 10px;">
						<textarea name="sndtext" id="sndtext" placeholder="输入聊天文本" style="height: 100%;width: 100%;resize: none;"></textarea>
					</td>
					<td style="padding: 10px;height: 40%;">
						<input name="sndnick" id="sndnick" type="text" placeholder="昵称" style="height: 100%;width: 100%;" />
					</td>
				</tr>
				<tr>
					<td style="padding: 10px; height: 60%;">
						<input name="sndbtn" id="sndbtn" type="button" value="发送" style="height: 100%; width: 100%;font-size: 50px;" />
					</td>
				</tr>
			</table>
		</div>
	</body>
</html>
		<script>
			var wsurl;
			var websocket;
			if (typeof WebSocket == 'undefined')
			{
				$('#st').text("浏览器不支持WebSocket!");
			}
			function conn()
			{
				if (websocket && websocket.readyState == 1)
				{
					return ;
				}
				wsurl = 'wss://' + $('#addr').val() + ':' + $('#port').val();
				websocket = new WebSocket(wsurl);
				websocket.onopen = function(event)
				{
					$('#st').text("已连接到服务器");
					$('#st').css('background-color', 'initial');
				}
				websocket.onclose = function(event)
				{
					$('#st').text("未连接到服务器");
					$('#st').css('background-color', 'red');
				}
				websocket.onmessage = function(event)
				{
					var lastmsg = jQuery.parseJSON(event.data);
					$('#msg').append("<table width='100%'><tr><td align='top' width='1px'>" + lastmsg['n'] + "：</td><td>" + lastmsg['t'] + "</td></tr></table>");
				}
			}
			function send()
			{
				if (websocket.readyState != 1)
				{
					return ;
				}
				var txt = $('#sndtext').val();
				var nick = $('#sndnick').val();
				var pack_msg = {t: txt, n: nick};
				
				if (!nick)
				{
					$('#sndnick').css('border-color', 'red');
					return ;
				}
				websocket.send(JSON.stringify(pack_msg));
				$('#sndtext').text('');
				$('#sndnick').text('');
				$('#sndnick').css('border-color', '');
			}
			function disconn()
			{
				if (websocket.readyState == 1)
				{
					websocket.close();
				}
			}
			$('#sndbtn').bind('click', function(){send()});
			$('#conn').bind('click', function(){conn()});
			$('#disc').bind('click', function(){disconn()});
		</script>
	
